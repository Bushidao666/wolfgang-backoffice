services:
  # Workaround for environments where Docker containers can't reach IPv6-only hosts
  # (Supabase direct DB host `db.<ref>.supabase.co` is IPv6 by default).
  #
  # This runs agent-runtime on the host network so it can use the host IPv6 stack,
  # and points it to Redis/Jaeger through the host-published ports.
  agent-runtime:
    network_mode: host
    ports: []
    extra_hosts: []
    environment:
      REDIS_URL: ${AGENT_RUNTIME_REDIS_URL:-redis://127.0.0.1:6380}
      OTEL_EXPORTER_OTLP_ENDPOINT: ${AGENT_RUNTIME_OTEL_EXPORTER_OTLP_ENDPOINT:-http://127.0.0.1:4318/v1/traces}
      DISABLE_CONNECTIONS: ${AGENT_RUNTIME_DISABLE_CONNECTIONS:-false}

  # When agent-runtime uses host networking, it is reachable from other containers
  # via `host.docker.internal` (already mapped in docker-compose.yml).
  backoffice-api:
    environment:
      AGENT_RUNTIME_URL: ${AGENT_RUNTIME_URL:-http://host.docker.internal:5000}
